#summary Gives a step by step tutorial taking you from the start to end of deploying an Easyshop inside a standard Plone installation
#labels Featured,Phase-Deploy

Table of Contents:
  # [StartToEndTutorial#Prerequisites:]
  # [StartToEndTutorial#Introduction:]
  # [StartToEndTutorial#Running-Zope-directly:]
  # [StartToEndTutorial#Creating-an-Easyshop-instance:]
  # [StartToEndTutorial#Creating-your-first-category-and-product:]
  # [StartToEndTutorial#Setting-up-shipping-prices-and-which-rate-of-VAT-is-to-be-applied-according-to-destination:]

= Prerequisites: =
  # A standard buildout based installation of [http://www.plone.org/ Plone]. We tested on Plone v3.3.4.
  # [http://subversion.tigris.org/ Subversion] installed. On Unices such as Debian Linux et al, this is easiest installed using something like `apt-get install subversion`.
  # You probably need root access on your deployment machine.
  # And you really, _really_ ought to test this on a local test machine first in case something really bad happens. We personally run [http://www.virtualbox.org/ VirtualBox] based copies of our internet services which we synchronise using a 1-to-1 rsync, so it lets us play and undo any damage we do with real server copies (it also acts as a convenient backup which can always be rsynced the other way if needs be).

Be aware that some parts of Easyshop is of alpha code quality at present: it generally mostly works, but there are occasional bugs and glitches most of which are listed on [http://code.google.com/p/easyshop-for-plone/issues/list the issue tracker]. I personally ([http://code.google.com/u/nialldouglas14/ Niall Douglas]) will happily fix any bugs you find in the Paypal payment deployment only as it's the only one I use myself and my business depends upon, and I would judge the Paypal payment deployment to be of beta quality approaching deployment quality. You can of course pay [http://code.google.com/p/easyshop-for-plone/people/list any of the contributors to Easyshop] to improve things that you particularly need.

= Installation: =
Your Plone installation is probably in something like `/usr/local/Plone/zeocluster` if you used the default settings for a ZEO deployment, so we'll assume that. Firstly you need a copy of SVN HEAD of Easyshop as it is still at beta quality, and you'll probably find a bug we haven't as it always seems to be, so as root:

{{{
cd /usr/local/Plone/zeocluster/src
svn checkout https://svn.plone.org/svn/archetypes/Products.DataGridField/trunk DataGridField-1.7
svn checkout http://easyshop-for-plone.googlecode.com/svn/buildout/3.0-Anonymous/ easyshop.buildout
}}}

Leave that run till it's done, then:

{{{
cd ..
nano buildout.cfg
}}}

We now need to add a lot of easyshop stuff to the buildout process, so:

{{{
eggs =
    ...
    easyshop.core
    easyshop.carts
    easyshop.catalog
    easyshop.checkout
    easyshop.criteria
    easyshop.customers
    easyshop.discounts
    easyshop.groups
    easyshop.information
    easyshop.kss
    easyshop.login
    easyshop.management
    easyshop.order
    easyshop.payment
    easyshop.shipping
    easyshop.shop
    easyshop.stocks
    easyshop.taxes
    Products.DataGridField
    ...

zcml =
    ...
    easyshop.core
    easyshop.carts
    easyshop.catalog
    easyshop.checkout
    easyshop.criteria
    easyshop.customers
    easyshop.discounts
    easyshop.groups
    easyshop.information
    easyshop.kss
    easyshop.login
    easyshop.management
    easyshop.order
    easyshop.payment
    easyshop.shipping
    easyshop.shop
    easyshop.stocks
    easyshop.taxes
    ...

develop =
    ...
    src/DataGridField-1.7
    src/easyshop.buildout/src/easyshop.core
    src/easyshop.buildout/src/easyshop.carts
    src/easyshop.buildout/src/easyshop.catalog
    src/easyshop.buildout/src/easyshop.checkout
    src/easyshop.buildout/src/easyshop.criteria
    src/easyshop.buildout/src/easyshop.customers
    src/easyshop.buildout/src/easyshop.discounts
    src/easyshop.buildout/src/easyshop.groups
    src/easyshop.buildout/src/easyshop.information
    src/easyshop.buildout/src/easyshop.kss
    src/easyshop.buildout/src/easyshop.login
    src/easyshop.buildout/src/easyshop.management
    src/easyshop.buildout/src/easyshop.order
    src/easyshop.buildout/src/easyshop.payment
    src/easyshop.buildout/src/easyshop.shipping
    src/easyshop.buildout/src/easyshop.shop
    src/easyshop.buildout/src/easyshop.stocks
    src/easyshop.buildout/src/easyshop.taxes
    ...

# You probably want this on:
debug-mode = on
}}}

The need for DataGridField as source rather than egg is because the latest version in the egg repos is Plone 4 only and Plone 3.x will puke with it. Thus you can either pin the version or keep a src copy from subversion - I just tend to prefer the latter as I find it less prone to buildout -n suddenly breaking everything.

Lastly:
{{{
cd products
ln -s ../src/easyshop.buildout/products/EasyShopTranslations EasyShopTranslations
cd ..
bin/buildout
}}}

You should now be ready to run, but if you want a currency other than Euro, British Sterling and US Dollars then you need to do one more thing:

{{{
nano src/easyshop.buildout/src/easyshop.core/easyshop/core/config.py
}}}

Here you can adjust various parameters for Easyshop, so if you want an extra currency you simply add it to the CURRENCIES section. You may also wish to edit VAT_COUNTRIES if you don't live in the EU, and DEFAULT_COUNTRIES if the countries you wish to deliver to aren't in the EU or USA. Lastly at the bottom is the all important PAYPAL_URL which lets you choose the Paypal Sandbox which is absolutely essential for testing that the shop absolutely & definitely will work with your customers in every conceivable scenario (e.g. if they are rejected, or they are using a stolen credit card etc).

= Running Zope directly: =
Personally I find that running Zope directly instead of using bin/plonectl is the easiest for debugging, so do:

{{{
parts/zeoserver/bin/runzeo &
parts/client1/bin/runzope &
}}}

... to start and a simple `killall python` to stop. This method prints all debug output to the terminal so you can see exception backtraces and such: very useful.

= Creating an Easyshop instance: =
Get into the ZMI and create a Plone site - you probably don't want to do this first time with an existing site until you've familiarised yourself with Easyshop's quirks. Once in the site, go to portal_quickinstaller or View/Site Setup/Add-on Products and add the Easyshop product.

Now you'll get an "Easyshop" item in the Add New drop down menu. So go ahead and add an Easyshop, giving it a title of "Shop" and a Shop Owner of whatever you want to appear on your product invoices. On the Misc tab most options are fairly self explanatory, but to clarify some of them you can choose "Gross Prices" if all the product prices you enter already include taxes, but for most people it's easiest to leave this turned off. If you are VAT registered and wish to allow VAT registered entities not in your local economy to have your local VAT rate removed, you can choose your local VAT country ID so Easyshop knows when it ought to charge VAT or not. Lastly, if you want Paypal as a payment option, you MUST fill in the Paypal account email address on the Payment tab.

So there you have it: your first Easyshop shop! After publishing it you ought to test it with an anonymous browser (i.e. one not logged in). I personally use IE8 for that as I never use IE for anything else :)

= Creating your first category and product: =
Easyshop uses categories to group products for your customers, whereas it uses groups to group products for you the admin only. Hence your products must always belong to at least one category for customers to find your product.

Before creating a category, you firstly need a Product to go into it. Click on Products in the Manager menu and do Add New/Product. Give it a Title of "Widget", a description, image and base price (say 100). Choosing the Advanced tab lets you choose Stock Amount, whether the stock is unlimited (for say an electronic good or service), whether the item is for sale and its sale price, whether it has accessories and so on. Choosing the Size tab lets you enter the all important weight and box dimensions which are so crucial to calculating Shipping. Give it a stock amount of 5 and a weight of 10kg, then hit Save.

Next we'll add some product options. Choose Product Properties and type "Case" and add the property. In the new Case field type "Gold Plated" in the Title field and type 50 into its price before hitting Add. Note that you can have product properties inherited from groups, so if you were selling say T-Shirts then you'd have a group of T-Shirts defining a common product property of "Size" which enables all products in that group to have the same product properties. Return to the view, and don't forget to publish it.

After all that you should see something like this:
<table style="width:auto;"><tr><td><a href="http://picasaweb.google.com/lh/photo/1Hm-PRPn5WMzplv8uyPCEQ?feat=embedwebsite"><img src="http://lh4.ggpht.com/_b8qB9CsK-a4/S5gOLGRnZVI/AAAAAAAAACc/srIU4hpLI3s/s800/Easyshop%20-%20Newly%20Added%20Product.png" /></a></td></tr><tr><td style="font-family:arial,sans-serif; font-size:11px; text-align:right">From <a href="http://picasaweb.google.com/nialldouglas14/EasyshopTutorial?feat=embedwebsite">Easyshop Tutorial</a></td></tr></table>

You'll surely note that the price is €125 rather than the €100 originally specified - this is because of the default VAT customer tax which is defined to be 25% in a new Easyshop installation (you can remove this simply by choosing Taxes from the Manager menu, then the Contents tab and delete as usual). Note also that your "Case" property is available, and if you choose the drop down menu you'll see "Gold Plated" as an option costing an extra €50. If you choose this, note that the overall product price is now €187.50 which is (base price + option) x (100 + customer taxes).

Now you need a category, so choose Categories from the Manager menu on the left. Type something like "Appliances" into the box and click on Add Category. Now choose the link that appears below it, then the Products tab and tick Widget before saving. Choose Appliances in the Categories list on the left and you should see your Widget. Publish the category now, and check that everything works using a non-logged-in browser by entering the Appliances category, choosing a Widget and adding it to your cart. If you view the cart using the cart summary in the right column you should see something like this:

<table style="width:auto;"><tr><td><a href="http://picasaweb.google.com/lh/photo/iMDEwP6mWN4h_Cyau68s0A?feat=embedwebsite"><img src="http://lh6.ggpht.com/_b8qB9CsK-a4/S5gVtWW8UgI/AAAAAAAAAC0/HdfudLwGcLM/s800/Easyshop%20-%20First%20Shopping%20Cart.png" /></a></td></tr><tr><td style="font-family:arial,sans-serif; font-size:11px; text-align:right">From <a href="http://picasaweb.google.com/nialldouglas14/EasyshopTutorial?feat=embedwebsite">Easyshop Tutorial</a></td></tr></table>

You'll surely note a few things from this. Firstly, shipping and payment method both cost €0 no matter what options you choose from the drop down box - this is because we haven't set these up yet. Secondly, there is a bug where the incl. Tax value isn't correct - I'll get round to fixing this soon.

Before we leave this section you should choose "Carts" from the Manager menu. You'll see a list of carts with their items along with their last modification dates - these are the carts which your website's visitors created but never sent to order. Most of the time this is because your customer went elsewhere, maybe because you didn't have a certain item in stock or maybe because they found a cheaper price elsewhere. Sometimes though it can be because the customer is building a cart over a few days. Either way, watching this can be an invaluable source of data when monitoring the performance of your shop.

= Setting up shipping prices and which rate of VAT is to be applied according to destination: =
One of the best parts of Easyshop is its comprehensive support for differing shipping methods and prices. Setting these up is extremely easy, so start by choosing Shipping Prices from the Manager menu which will show you "There are no shipping prices".

Remedy this by adding the following Shipping Prices:
  # "Electronic Delivery" costing €0. Once in the shipping price item page add a new weight criteria choosing < 0.01, then a further "Combined Length and Girth" criteria choosing < 0.01.
  # "Courier to Ireland" costing €15. Once in the shipping price item page add a new "Country Criteria" choosing Ireland.
  # "Courier to UK" costing €20. Once in the shipping price item page add a new "Country Criteria" choosing the United Kingdom.
  # "Courier to Europe" costing €35. Once in the shipping price item page add a new "Country Criteria" choosing all European countries except Ireland and the UK.
  # "Courier to Rest of World" costing €75. Don't add any criteria here.

Enter the Shipping Prices Contents tab and select all the items and click on "Change State". Tick "Include contained items" and change the state to "Publish".

Now refresh the view in your not-logged-in web browser - you should see that shipping now has a value! Try choosing different countries using the Country drop down box: choosing Ireland should choose a shipping of €18.75 (€15 + VAT) via AJAX, some European country such as Austria should be €43.75 (€35 + VAT) and choosing the USA should be €62.50 (€50 + VAT).

Those familiar with VAT will know that VAT is not to be applied to customers outside the EU, so to fix this choose the Taxes option from the Manager menu and then choose VAT. Add a new country criteria including all European countries (so all but the USA). Note how VAT is now applied only when the destination is a European country, but is no longer applied when the destination is the USA.

By applying similar criteria you can configure different VAT rates according to destination country (which is now the law if your sales exceed a certain amount annually). You can also apply criteria which change price according to item weight or size, or have one set of customers get preferential shipping rates (e.g. if they regularly buy in bulk from you). One of the most obvious criteria is to set up two shipping methods i.e. "Standard 2-3 day delivery" and "Expedited next day delivery" and then have the shipping prices select on shipping method.

Remember that shipping prices are chosen in consecutive priority, so the "Courier to Rest of World" we added above was added last and is therefore placed at lowest priority. As it has no criteria, it will always be chosen if no other prior shipping price has its criteria met.

Lastly, setting up Payment Prices is identical to Shipping Prices. Easyshop comes with a range of default payment methods - simply delete those you don't need. For any reasonably small shop, deleting all but Paypal is a good idea as Paypal will also process credit and debit cards for you if you register the account as a business account and unless you're processing serious volume, Paypal's fees will usually be cheaper than a merchant services account.